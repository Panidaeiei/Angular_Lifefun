<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<div class="background-div">
    <mat-toolbar class="fixed-toolbar modern-toolbar">
        <a [routerLink]="['']" class="toolbar-logo">
            <img src="../../../assets/images/Logoweb.png" alt="Home Icon" style="width: 60px;" />
        </a>
        <div class="toolbar-center-menu" *ngIf="!isMobile">
            <a class="menu-item" [routerLink]="['']">
                <span>หน้าหลัก</span>
            </a>
            <a class="menu-item" [routerLink]="['/search_main']">
                <span style="color: black;">ค้นหา</span>
            </a>
            <a class="menu-item" routerLinkActive="active" [routerLink]="['/category_main']">
                <span>หมวดหมู่</span>
            </a>
        </div>
        <button routerLink="/login" class="login-link modern-login" *ngIf="!isMobile">
            <i class="material-icons">login</i>
            <span>เข้าสู่ระบบ/สมัครสมาชิก</span>
        </button>
        <button class="toolbar-hamburger" (click)="toggleDrawer()" aria-label="เมนู" *ngIf="isMobile">
            <i class="fa-solid fa-bars"></i>
        </button>
    </mat-toolbar>
</div>
<!-- Drawer สำหรับ mobile -->
<div class="drawer" [class.open]="isDrawerOpen">
    <div class="drawer-content">
        <h3 style="font-weight: 500; font-size: 30px;">MENU</h3>
        <ul style="list-style: none; padding: 0;">
            <li style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-house" style="font-size: 20px; color: black;"></i>
                <a [routerLink]="['/']" style="text-decoration: none; color: black;">
                    <span>หน้าหลัก</span>
                </a>
            </li>
            <li style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-magnifying-glass" style="font-size: 20px; color: black;"></i>
                <a [routerLink]="['/search_main']" style="text-decoration: none; color: black;">
                    <span>ค้นหา</span>
                </a>
            </li>
            <li style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-bars" style="font-size: 20px; color: black;"></i>
                <a [routerLink]="['/category_main']" style="text-decoration: none; color: black;">
                    <span>หมวดหมู่</span>
                </a>
            </li>
            <li style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                <i class="material-icons" style="font-size: 20px; color: black;">login</i>
                <a [routerLink]="['/login']" style="text-decoration: none; color: black;">
                    <span>เข้าสู่ระบบ/สมัครสมาชิก</span>
                </a>
            </li>
        </ul>
        <button mat-flat-button style="background-color: rgb(226, 124, 150); width: 100px;" (click)="toggleDrawer()">ปิด</button>
    </div>
</div>
<div>
    <!-- Loading State -->
    <div *ngIf="isLoading" style="display: flex; justify-content: center; align-items: center; margin-top: 200px;">
        <div style="text-align: center;">
            <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #e27c96; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            <p style="margin-top: 20px; color: #666;">กำลังโหลดข้อมูล...</p>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage && !isLoading" style="display: flex; justify-content: center; align-items: center; margin-top: 200px;">
        <div style="text-align: center; color: #e74c3c;">
            <i class="material-icons" style="font-size: 48px; margin-bottom: 10px;">error</i>
            <p>{{ errorMessage }}</p>
        </div>
    </div>

    <!-- Mock Data Notice -->
    <div *ngIf="!isLoading && !errorMessage && isMockData" style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
        <div style="text-align: center; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 12px; max-width: 600px;">
            <i class="material-icons" style="font-size: 24px; color: #856404; margin-bottom: 8px;">info</i>
            <p style="color: #856404; margin: 0; font-size: 14px;">
                <strong>หมายเหตุ:</strong> ข้อมูลที่แสดงเป็นข้อมูลตัวอย่าง เนื่องจากคุณยังไม่ได้เข้าสู่ระบบ 
                กรุณา <a routerLink="/login" style="color: #e27c96; text-decoration: underline;">เข้าสู่ระบบ</a> เพื่อดูข้อมูลจริง
            </p>
        </div>
    </div>

    <!-- PROFILE HEADER (responsive) -->
    <div *ngIf="!isLoading && !errorMessage" style="display: flex; flex-direction: column; margin-top: 170px;">
        <!-- MOBILE IG-style profile header (no story) -->
        <div *ngIf="isMobile" class="profile-header-mobile">
            <div style="display: flex; flex-direction: row; align-items: center; gap: 18px;">
                <img [src]="userProfile?.image_url || 'https://i.pinimg.com/736x/a8/0e/36/a80e3690318c08114011145fdcfa3ddb.jpg'" class="profile-avatar" />
                <div class="profile-info-mobile">
                    <div class="profile-row-mobile">
                        <span class="profile-username-mobile">{{ userProfile?.username || 'Username' }}</span>
                        <button class="buttonEdit-mobile" (click)="onloginClick()">ติดตาม</button>
                        <button *ngIf="userProfile" class="buttonsend buttonEdit-mobile" (click)="onloginClick()">
                            <i class="fa-solid fa-envelope" style="font-size: 16px;"></i>
                        </button>
                    </div>
                    <div class="profile-stats-mobile">
                        <div class="profile-stat-mobile">
                            <span class="profile-stat-number-mobile">{{ userPosts.length }}</span>
                            <span class="profile-stat-label-mobile">โพสต์</span>
                        </div>
                        <div class="profile-stat-mobile">
                            <span class="profile-stat-number-mobile">{{ followersCount }}</span>
                            <span class="profile-stat-label-mobile">ผู้ติดตาม</span>
                        </div>
                        <div class="profile-stat-mobile">
                            <span class="profile-stat-number-mobile">{{ followingCount }}</span>
                            <span class="profile-stat-label-mobile">กำลังติดตาม</span>
                        </div>
                    </div>
                    <div class="profile-description-mobile">
                        {{ userProfile?.description || '' }}
                    </div>
                </div>
            </div>
        </div>
        <!-- DESKTOP/TABLET UI -->
        <div *ngIf="!isMobile">
            <div style="display: flex; flex-direction: row; justify-content: center;">
                <div style="display: flex; flex-direction: row; gap: 180px;">
                    <div class="profile-header-container">
                        <div class="profile-header">
                            <img [src]="userProfile?.image_url || 'https://i.pinimg.com/736x/a8/0e/36/a80e3690318c08114011145fdcfa3ddb.jpg'" class="profile-avatar">
                            <div class="profile-info">
                                <div class="profile-username-row">
                                    <span class="profile-username">{{ userProfile?.username || 'Username' }}</span>
                                    <button class="buttonEdit" (click)="onloginClick()">ติดตาม</button>
                                    <button *ngIf="userProfile" class="buttonsend" (click)="onloginClick()">
                                        <i class="fa-solid fa-envelope" style="font-size: 20px;"></i>
                                    </button>
                                </div>
                                <div class="profile-stats">
                                    <div class="profile-stat">
                                        <span class="profile-stat-number">{{ userPosts.length }}</span>
                                        <span class="profile-stat-label">จำนวนโพสต์</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="profile-stat-number">{{ followersCount }}</span>
                                        <span class="profile-stat-label">ผู้ติดตาม</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="profile-stat-number">{{ followingCount }}</span>
                                        <span class="profile-stat-label">กำลังติดตาม</span>
                                    </div>
                                </div>
                                <span class="profile-description">{{ userProfile?.description || '' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- POST GRID (mat-tab-group) -->
    <div style="display: flex; justify-content: center; align-items: center; margin-top: 50px; z-index: 1;">
        <mat-tab-group [style.width.%]="isMobile ? 100 : 70">
            <!-- โพสต์ของผู้ใช้ -->
            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon matTooltip="โพสต์">apps</mat-icon>
                </ng-template>
                <div class="post-grid">
                    <div *ngFor="let post of userPosts" class="post-item">
                        <div>
                            <a (click)="onloginClick()">
                                <img *ngIf="post.media_type === 'image'" [src]="post.firstMediaUrl || 'https://via.placeholder.com/350x300'" alt="รูปที่โพสต์" class="post-image">
                                <video *ngIf="post.media_type === 'video'" [src]="post.firstMediaUrl" controls class="post-video"></video>
                            </a>
                            <div *ngIf="post.hasMultipleMedia" class="multiple-media-icon">
                                <i class="fa fa-clone" style="font-size: 30px; color: white; position: absolute; top: 10px; right: 10px; padding: 5px; border-radius: 50%;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon matTooltip="แชร์โพสต์">share</mat-icon>
                </ng-template>
                <div class="post-grid">
                    <div *ngFor="let post of sharedPosts" class="post-item">
                        <div>
                            <a (click)="onloginClick()">
                                <img *ngIf="post.media_type === 'image'" [src]="post.firstMediaUrl || 'https://via.placeholder.com/350x300'" alt="รูปที่โพสต์" class="post-image">
                                <video *ngIf="post.media_type === 'video'" [src]="post.firstMediaUrl" controls class="post-video"></video>
                            </a>
                            <div *ngIf="post.hasMultipleMedia" class="multiple-media-icon">
                                <i class="fa fa-clone" style="font-size: 30px; color: white; position: absolute; top: 10px; right: 10px; padding: 5px; border-radius: 50%;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon matTooltip="บันทึกโพสต์">bookmark</mat-icon>
                </ng-template>
                <div class="post-grid">
                    <div *ngFor="let post of savedPosts" class="post-item">
                        <div>
                            <a  (click)="onloginClick()">
                                <img *ngIf="post.media_type === 'image'" [src]="post.firstMediaUrl || ''" alt="รูปที่โพสต์" class="post-image">
                                <video *ngIf="post.media_type === 'video'" [src]="post.firstMediaUrl" controls class="post-video"></video>
                            </a>
                            <div *ngIf="post.hasMultipleMedia" class="multiple-media-icon">
                                <i class="fa fa-clone" style="font-size: 30px; color: white; position: absolute; top: 10px; right: 10px; padding: 5px; border-radius: 50%;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
        <div *ngIf="isDialogOpen" class="dialog-overlay" (click)="closeDialog()">
            <div class="dialog-box" (click)="$event.stopPropagation()">
                <button class="close-button" (click)="closeDialog()">×</button>
                <img src="../../../assets/images/Logoweb.png" alt="Home Icon" width="140px">
                <h3>กรุณาเข้าสู่ระบบ/สมัครสมาชิก</h3>
                <button class="button1" (click)="navigateToLogin()">เข้าสู่ระบบ</button>
            </div>
        </div>
    </div>
</div>