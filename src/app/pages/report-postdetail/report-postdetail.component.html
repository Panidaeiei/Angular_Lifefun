<mat-toolbar class="admin-toolbar">
    <!-- Logo ด้านซ้าย -->
    <a  class="logo-link">
        <img src="../../../assets/images/Logoweb.png" alt="Home Icon" class="logo-image">
    </a>

    <!-- เมนูตรงกลาง -->
    <div class="center-menu">
        <a class="menu-item" [routerLink]="['/userlist']" [queryParams]="{ id: adminId }">
            <i class="fa-solid fa-users"></i>
            <span class="itim-regular">ผู้ใช้งาน</span>
        </a>

        <a class="menu-item" [routerLink]="['/noti_addmin']" [queryParams]="{ id: adminId }">
            <i class="fa-solid fa-bell"></i>
            <span class="itim-regular">การแจ้งเตือน</span>
        </a>
    </div>

    <!-- เมนูขวาสุด -->
    <div class="toolbar-actions">
        <button class="logout-button" (click)="logout()">
            <i class="fa-solid fa-sign-out-alt"></i>
            <span>ออกจากระบบ</span>
        </button>
    </div>
</mat-toolbar>

<!-- Main Content Container -->
<div class="admin-content-container">
    <!-- Post Management Header -->
    <div class="management-header">
        <h1 class="page-title">จัดการโพสต์ที่ถูกรายงาน</h1>
        <p class="page-subtitle">ตรวจสอบและดำเนินการกับโพสต์ที่ไม่เหมาะสม</p>
    </div>

    <!-- Post Card -->
    <div *ngIf="post" class="post-card" [ngClass]="{'deleting': isDeletingPost}">
        <!-- Loading Overlay -->
        <div *ngIf="isDeletingPost" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>กำลังดำเนินการ...</p>
            </div>
        </div>

        <!-- User Info Section -->
        <div class="user-info-section">
            <div class="user-profile">
                <img [src]="post.user_profile_image || 'https://i.pinimg.com/736x/a8/0e/36/a80e3690318c08114011145fdcfa3ddb.jpg'"
                    alt="รูปโปรไฟล์" class="profile-image">
                <div class="user-details">
                    <h3 class="username">{{ post.user_name }}</h3>
                    <p class="post-time">{{ post.post_time | timeAgo }}</p>
                    <div *ngIf="post.location" class="location-info">
                        <i class="fa-solid fa-location-dot"></i>
                        <a [href]="post.location" target="_blank" class="location-link">
                            {{ post.location.length > 30 ? (post.location.substring(0, 30) + '...') : post.location }}
                        </a>
                    </div>
                </div>
            </div>

            <!-- Admin Actions Menu -->
            <div class="admin-actions">
                <button mat-icon-button [matMenuTriggerFor]="adminMenu" class="action-button">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </button>

                <mat-menu #adminMenu="matMenu" class="admin-menu">
                    <!-- Ban User Option -->
                    <button mat-menu-item (click)="banUser(post.user_uid, post.user_name)" 
                            class="ban-user-btn"
                            [disabled]="isBanningUser"
                            [matTooltip]="isBanningUser ? 'กำลังระงับบัญชี...' : 'ระงับบัญชีผู้ใช้'">
                        <i class="fa-solid fa-user-slash"></i>
                        <span>{{ isBanningUser ? 'กำลังระงับ...' : 'ระงับบัญชีผู้ใช้' }}</span>
                    </button>

                    <!-- Delete Post Option -->
                    <button mat-menu-item (click)="deletePost(post.post_id)" 
                            class="delete-post-btn"
                            [disabled]="isDeletingPost" 
                            [matTooltip]="isDeletingPost ? 'กำลังลบโพสต์...' : 'ลบโพสต์'">
                        <i class="fa-solid fa-trash"></i>
                        <span>{{ isDeletingPost ? 'กำลังลบ...' : 'ลบโพสต์' }}</span>
                    </button>

                    <!-- View User Profile -->
                    <button mat-menu-item (click)="viewUserProfile(post.user_uid)" class="view-profile-btn">
                        <i class="fa-solid fa-user"></i>
                        <span>ดูโปรไฟล์ผู้ใช้</span>
                    </button>
                </mat-menu>
            </div>
        </div>

        <!-- Media Content -->
        <div class="media-section">
            <div *ngIf="post.images.length || post.videos.length" class="media-slider" 
                 (mouseenter)="showControls()" (mouseleave)="hideControls()"
                 (touchstart)="onTouchStart($event)" (touchmove)="onTouchMove($event)" (touchend)="onTouchEnd($event)"
                 style="touch-action: pan-y pinch-zoom;">
                <div class="media-container" style="position: relative;">
                    <div *ngIf="currentMediaIndex >= 0 && currentMedia">
                        <ng-container *ngIf="currentMedia.type === 'image'; else videoTemplate">
                            <img [src]="currentMedia.url" alt="โพสต์รูปภาพ"
                            style="width: 100%; height: auto; max-height: 500px; object-fit: cover; ">
                        </ng-container>
                        <ng-template #videoTemplate>
                            <video [src]="currentMedia.url" controls
                            style="width: 100%; height: auto; max-height: 500px; object-fit: cover; "></video>
                        </ng-template>
                    </div>

                    <!-- ปุ่มเลื่อน (Previous/Next) -->
                    <div class="slider-controls" *ngIf="(post.images.length + post.videos.length) > 1">
                        <button (click)="prevMedia()" class="prev-btn" style="touch-action: manipulation;"
                            [disabled]="currentMediaIndex === 0" matTooltip="รูปก่อนหน้า">❮</button>
                        <button (click)="nextMedia()" class="next-btn" style="touch-action: manipulation;"
                            [disabled]="currentMediaIndex === (post.images.length + post.videos.length - 1)" matTooltip="รูปถัดไป">❯</button>
                    </div>

                    <!-- แสดงสถานะการเลื่อน (จำนวนรูป/วิดีโอ) -->
                    <div class="media-indicator" *ngIf="(post.images.length + post.videos.length) > 1">
                        <span class="indicator-text">{{ currentMediaIndex + 1 }} / {{ post.images.length + post.videos.length }}</span>
                    </div>

                    <!-- Dots Indicator (แสดงเฉพาะถ้ามี media > 1) -->
                    <div class="media-dots" *ngIf="(post.images.length + post.videos.length) > 1">
                        <span *ngFor="let m of [].constructor(post.images.length + post.videos.length); let i = index"
                            [class.active]="i === currentMediaIndex" class="dot"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Post Content -->
        <div class="post-content">
            <div class="post-text">
                <span style="font-size: 18px;" [innerHTML]="post.title | newlineToBr"></span>
            </div>
        </div>

    </div>

    <!-- No Post Message -->
    <div *ngIf="!post" class="no-post-message">
        <i class="fa-solid fa-exclamation-triangle"></i>
        <p>ไม่พบข้อมูลโพสต์</p>
    </div>
</div>