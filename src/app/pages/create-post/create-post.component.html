<mat-toolbar class="fixed-toolbar">
    <!-- Logo ด้านซ้าย -->
    <a [routerLink]="['/HomepageUser']" [queryParams]="{ id: userId }">
        <img src="https://shorturl.asia/2pOd3" alt="Home Icon" width="80px">
    </a>
    <div style="width: 10%;"></div>
    <!-- เมนูตรงกลาง -->
    <div style="display: flex; flex-grow: 1; justify-content: center; align-items: center;">
        <div style="display: flex; justify-content: center; align-items: center; gap: 50px;">

            <div style="display: flex; flex-direction: column; align-items: center;">
                <a [routerLink]="['/HomepageUser']" [queryParams]="{ id: userId }">
                    <i style="font-size: 40px; color: black;" class="fa-solid fa-house"></i>
                </a>
                <span class="itim-regular">หน้าหลัก</span>
            </div>

            <!-- ติดตาม -->
            <div style="display: flex; flex-direction: column; align-items: center;">
                <a [routerLink]="['/Homepagefollow']" [queryParams]="{ id: userId }">
                    <i style="font-size: 40px; color: black;" class="fa-solid fa-users"></i>
                </a>
                <span class="itim-regular">ติดตาม</span>
            </div>

            <div>
                <a [routerLink]="['/CreatePost']" [queryParams]="{ id: userId }"><img
                        src="https://shorturl.asia/ngKuG" alt="" width="60px"></a>
            </div>

            <!-- การแจ้งเตือน -->
            <div style="display: flex; flex-direction: column; align-items: center;">
                <a [routerLink]="['/Notification_user']" [queryParams]="{ id: userId }">
                    <i style="font-size: 40px; color: black;" class="fa-solid fa-bell"></i>
                </a>
                <span class="itim-regular">การแจ้งเตือน</span>
            </div>

            <!-- โปรไฟล์ -->
            <div style="display: flex; flex-direction: column; align-items: center;">
                <a [routerLink]="['/ProfileUser']" [queryParams]="{ id: userId }">
                    <i style="font-size: 40px; color: black;" class="fa-solid fa-user"></i>
                </a>
                <span class="itim-regular">โปรไฟล์</span>
            </div>
        </div>
    </div>

    <!-- ช่องค้นหา -->
    <div class="search-container">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" class="search-input" placeholder="ค้นหา...">
    </div>

    <!-- ไอคอนเมนู -->
    <div style="display: flex; flex-direction: column; align-items: center; margin-left: 20px;">
        <a href="javascript:void(0)" (click)="toggleDrawer()">
            <i style="font-size: 40px; color: black;" class="fa-solid fa-bars"></i>
        </a>
    </div>

    <!-- Drawer -->
    <div class="drawer" [class.open]="isDrawerOpen">
        <div class="drawer-content">
            <h3 style="font-weight: 500; font-size: 30px;">MENU</h3>
            <ul style="list-style: none; padding: 0;">
                <!-- หมวดหมู่ -->
                <li
                    style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fa fa-list" style="font-size: 20px; color: black;"></i>
                    <a [routerLink]="['/category']" [queryParams]="{ id: userId }" style="text-decoration: none; color: black;">
                        <span class="itim-regular">หมวดหมู่</span>
                    </a>
                </li>
                <!-- ออกจากระบบ -->
                <li
                    style="border-bottom: 1px solid #ccc; padding: 10px 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fa fa-sign-out" style="font-size: 20px; color: black;"></i>
                    <a href="/login" style="text-decoration: none; color: black;">
                        <span class="itim-regular">ออกจากระบบ</span>
                    </a>
                </li>
            </ul>
            <button mat-flat-button style="background-color: rgb(226, 124, 150); width: 100px;"
                (click)="toggleDrawer()">ปิด</button>
        </div>
    </div>
</mat-toolbar>

<div class="background-div">
    <div>
        <div style="padding: 50px 30rem; margin-top: 80px;">
            <mat-card appearance="raised">
                <div *ngIf="isLoading" class="loading-overlay">
                    <div class="loading-spinner-container">
                        <div class="spinner"></div>
                        <p>กำลังโพสต์...</p>
                    </div>
                </div>

                <mat-card-header style="display: flex; flex-direction: column; background-color: #faddd9; ">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div></div>
                        <span class="itim-regular2">สร้างโพสต์ใหม่</span>
                        <a [routerLink]="['/HomepageUser']" [queryParams]="{ id: userId }"
                            style="text-decoration: none;">
                            <i class="fa-solid fa-xmark" style="color: #9ca3af; cursor: pointer; font-size: 16px; background-color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;"></i>
                        </a>
                    </div>

                    <div style="display: flex; align-items: center; gap: 20px; margin-top: 10px; margin-bottom: 20px;">
                        <img [src]="user?.image_url ?? 'https://i.pinimg.com/736x/a8/0e/36/a80e3690318c08114011145fdcfa3ddb.jpg'" alt="User Profile Image"
                            width="80px" height="80px" style="border-radius: 50%; object-fit: cover;" />

                        <div style="display: flex; flex-direction: column; margin-left: 5px; margin-right: 5px;">
                            <span style="font-size: 20px; font-weight: bold;">{{ user?.username || 'ชื่อผู้ใช้'
                                }}</span>
                            <div style="display: flex; gap: 20px; align-items: center; margin-top: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="text" [(ngModel)]="postData.location" name="location"
                                        placeholder="เพิ่มลิงค์ตำแหน่งสถานที่"
                                        style="padding: 10px; border: 1px solid #ccc; border-radius: 20px; font-size: 14px; width: 100%; max-width: 300px;" />
                                </div>
                                <mat-chip [matMenuTriggerFor]="menu"
                                    style="background-color: white; border-radius: 20px; box-shadow: none;">
                                    {{ getCategoryName(postData.cat_id) }}
                                </mat-chip>
                                <mat-menu class="mat-menu-panel" #menu="matMenu" style="border-radius: 8px;">
                                    <button mat-menu-item *ngFor="let category of categories"
                                        (click)="setCategory(category.cat_id)">
                                        {{ category.name }}
                                    </button>
                                </mat-menu>
                            </div>
                        </div>
                    </div>
                </mat-card-header>
                <mat-card-content style="background-color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; height: 700px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <div style="position: relative; width: 100%; height: 100%; overflow: hidden; border-radius: 8px;">
                        <!-- ปุ่มเพิ่มไฟล์ -->
                        <button
                            style="position: absolute; top: 10px; right: 10px; background-color: #d1d2d3; color: white; padding: 10px 20px; border: none; border-radius: 50px; font-size: 14px; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 10;"
                            (click)="triggerFileInput()">
                            <span style="font-size: 30px;">+</span>
                        </button>
                        <input id="file-input" type="file" hidden accept="image/*,video/*"
                            (change)="onFileSelected($event)" />

                        <!-- ปุ่มลบไฟล์ -->
                        <button *ngIf="files.length > 0"
                            style="position: absolute; top: 10px; left: 10px; background-color: rgb(216, 57, 57); color: white; padding: 5px 10px; border: none; border-radius: 50%; font-size: 16px; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); z-index: 5;"
                            (click)="confirmRemoveFile()">
                            <span style="font-size: 20px;">×</span>
                        </button>

                        <!-- แสดงรูปภาพ -->
                        <div *ngIf="currentFile?.type === 'image'" style="width: 100%; height: 100%;">
                            <img [src]="currentFile.url" alt="Selected Image"
                                style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" />
                        </div>

                        <!-- แสดงวิดีโอ -->
                        <div *ngIf="currentFile?.type === 'video'" style="width: 100%; height: 100%;">
                            <video [src]="currentFile.url" controls
                                style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></video>
                        </div>

                        <!-- ปุ่มเลื่อนซ้าย -->
                        <button *ngIf="files.length > 1" (click)="previousFile()"
                            style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); background: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">
                            ‹
                        </button>

                        <!-- ปุ่มเลื่อนขวา -->
                        <button *ngIf="files.length > 1" (click)="nextFile()"
                            style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%); background: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">
                            ›
                        </button>
                    </div>
                </mat-card-content>

                <div *ngIf="fullscreenFile" class="fullscreen-overlay">
                    <div class="fullscreen-content">
                        <div *ngIf="fullscreenFile.type === 'image'">
                            <img [src]="fullscreenFile.url" alt="Fullscreen Image"
                                style="max-width: 100%; max-height: 100%; object-fit: contain;" />
                        </div>
                        <div *ngIf="fullscreenFile.type === 'video'">
                            <video [src]="fullscreenFile.url" controls
                                style="max-width: 100%; max-height: 100%; object-fit: contain;"></video>
                        </div>
                    </div>
                </div>

                <mat-card-footer
                    style="background-color: #faddd9; display: flex; flex-direction: column; height: 100px;">
                    <textarea [(ngModel)]="postData.title" name="title"
                        style="border: 1px solid #e2e8f0; background-color: transparent; border-radius: 8px; font-size: 16px; height: 100px; padding: 10px; resize: none; transition: all 0.2s;"
                        placeholder="เขียนเรื่องราว..."></textarea>
                </mat-card-footer>

                <mat-card-footer *ngIf="!isLoading"
                    style="background-color: #f2aea3; padding: 10px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; border-radius: 8px;"
                    (click)="submitPost()">
                    <span class="itim-regular2" style="color: white;">โพสต์</span>
                </mat-card-footer>
            </mat-card>
        </div>
    </div>

</div>